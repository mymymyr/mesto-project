(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",closeBtnSelector:".popup__close-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"form__input-error"},t="https://nomoreparties.co/v1/plus-cohort-14/",n="eaada802-eae7-468f-b2f3-51d625f02b5e";function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var r=function(e,t){e.querySelector(".elements__like-counter").textContent=t},c=function(e){e.style.display="block",e.addEventListener("click",(function(){var r;(r=e.parentElement.id,fetch("".concat(t,"/cards/").concat(r),{method:"DELETE",headers:{authorization:n}}).then((function(e){return o(e)}))).then((function(){e.parentElement.remove()})).catch((function(e){return console.log(e.message)}))}))},i=function(e,c,i,u,a){var s=document.querySelector("#elements__item-template").content.querySelector(".elements__item").cloneNode(!0),l=s.querySelector(".elements__image"),f=s.querySelector(".elements__like-button");return r(s,u.length),u.forEach((function(e){e._id===a&&f.classList.add("elements__like-button_active")})),s.querySelector(".elements__text").textContent=e,l.alt=e,l.src=c,s.id=i,function(e){!function(e){var c=e.querySelector(".elements__like-button");c.addEventListener("click",(function(){var i,u;c.classList.contains("elements__like-button_active")?(u=e.id,i=fetch("".concat(t,"/cards/likes/").concat(u),{method:"DELETE",headers:{authorization:n}}).then((function(e){return o(e)}))):i=function(e){return fetch("".concat(t,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:n}}).then((function(e){return o(e)}))}(e.id),i.then((function(t){r(e,t.likes.length),c.classList.toggle("elements__like-button_active")})).catch((function(e){return console.log(e.message)}))}))}(e)}(s),s},u=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n),o.textContent=""},a=function(e,t,n){var o=function(e){return e.some((function(e){return!e.validity.valid}))}(e);o?t.classList.add(n):t.classList.remove(n),t.disabled=o};function s(e){e.target.classList.contains("popup")&&d(e.target)}function l(e){Array.from(document.querySelectorAll(".popup")).forEach((function(t){"Escape"===e.key&&t.classList.contains("popup_opened")&&d(t)}))}var f=function(e){e.classList.add("popup_opened"),e.addEventListener("click",s),document.addEventListener("keyup",l)},d=function(e){e.classList.remove("popup_opened"),e.removeEventListener("click",s),document.removeEventListener("keyup",l)},m='.popup__item[id="heading"]',p='.popup__item[id="subheading"]',_=document.querySelector(".profile__title"),v=document.querySelector(".profile__subtitle"),h=document.querySelector(".elements__items"),y=document.querySelector(".popup_position_img"),S=y.querySelector(".popup__image"),q=y.querySelector(".popup__text"),C=y.querySelector(".popup__close-button"),E=document.forms.profile,b=E.querySelector(m),g=E.querySelector(p),L=E.querySelector(".button-form"),k=document.forms.place,x=k.querySelector(m),A=k.querySelector(p),T=k.querySelector(".button-form"),z=document.forms.photo,B=z.querySelector(m),j=z.querySelector(".button-form"),D=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__edit-photo-button"),O=document.querySelector(".profile__avatar"),J="",M=function(e,t){e.addEventListener("click",(function(){d(t)}))};M(C,y);var V=function(e,t){e.addEventListener("click",(function(){f(y),function(e,t){S.src=e.src,S.alt=e.alt,q.textContent=t}(e,t)}))},H=function(){b.value=_.textContent,g.value=v.textContent},w=function(t){P.addEventListener("click",(function(){f(t),H(),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.classList.remove(t.inputErrorClass),n.setCustomValidity(""),u(e,n,t.errorClass)})),a(n,o,t.inactiveButtonClass)}(t,e)}))},U=function(e){_.textContent=e.name,v.textContent=e.about,O.src=e.avatar,J=e._id};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(r){var u=r.parentElement.parentElement,a=u.querySelector(e.closeBtnSelector);r===E?(r.addEventListener("submit",(function(e){return function(e,r){e.preventDefault();var c,i,u=L.textContent;L.textContent="Сохранение...",(c=b.value,i=g.value,fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:c,about:i})}).then((function(e){return o(e)}))).then((function(e){U(e),d(r),L.textContent=u})).catch((function(e){L.textContent=u,console.log("Ошибка ".concat(e.message))}))}(e,u)})),H(),w(u)):r===k?(r.addEventListener("submit",(function(e){return function(e,r,u){e.preventDefault();var a,s,l=T.textContent;T.textContent="Сохранение...",(a=x.value,s=A.value,fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({name:a,link:s})}).then((function(e){return o(e)}))).then((function(e){var t=i(e.name,e.link,e._id,e.likes,J);c(t.querySelector(".elements__trash-button")),V(t.querySelector(".elements__image")),function(e){h.prepend(e)}(t),d(u),r.reset(),T.textContent=l})).catch((function(e){T.textContent=l,console.log("Ошибка ".concat(e.message))}))}(e,r,u)})),function(e){D.addEventListener("click",(function(){f(e)}))}(u)):r===z&&(r.addEventListener("submit",(function(e){return function(e,r,c){e.preventDefault();var i=j.textContent;j.textContent="Сохранение...",function(e){return fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return o(e)}))}(B.value).then((function(e){O.src=e.avatar,d(c),r.reset(),j.textContent=i})).catch((function(){j.textContent=i,console.log("Ошибка ".concat(err.message))}))}(e,r,u)})),function(e){N.addEventListener("click",(function(){f(e)}))}(u)),M(a,u)}))}(e),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t,n,o,r,c){a(e,t,o),e.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(u(e,t,o),t.classList.remove(n)):(function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o)}(e,t,t.validationMessage,o),t.classList.add(n))}(n,i,r,c),a(e,t,o)}))}))}(Array.from(t.querySelectorAll(e.inputSelector)),t.querySelector(e.submitButtonSelector),t,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)}))}(e),fetch("".concat(t,"/users/me"),{headers:{authorization:n}}).then((function(e){return o(e)})).then((function(e){return U(e)})).then((function(){fetch("".concat(t,"/cards"),{headers:{authorization:n}}).then((function(e){return o(e)})).then((function(e){e.forEach((function(e){var t=i(e.name,e.link,e._id,e.likes,J);V(t.querySelector(".elements__image")),e.owner._id===J&&c(t.querySelector(".elements__trash-button")),function(e){h.append(e)}(t)}))})).catch((function(e){console.log(e.message)}))})).catch((function(e){console.log(e.message)}))})();