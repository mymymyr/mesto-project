(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",closeBtnSelector:".popup__close-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"form__input-error"},t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14/",headers:{authorization:"eaada802-eae7-468f-b2f3-51d625f02b5e","Content-Type":"application/json"}};function n(e,t){return fetch(e,t).then((function(e){return function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}(e)}))}var o=Array.from(document.querySelectorAll(".popup"));function r(e){e.target.classList.contains("popup")&&a(e.target)}function c(e){"Escape"===e.key&&o.forEach((function(e){e.classList.contains("popup_opened")&&a(e)}))}var i=function(e){e.classList.add("popup_opened"),e.addEventListener("click",r),document.addEventListener("keyup",c)},a=function(e){e.classList.remove("popup_opened"),e.removeEventListener("click",r),document.removeEventListener("keyup",c)},u=function(e,t){e.textContent=t},s=function(e,o,r,c,a){var s,l=document.querySelector("#elements__item-template").content.querySelector(".elements__item").cloneNode(!0),d=l.querySelector(".elements__image"),f=l.querySelector(".elements__like-button"),p=l.querySelector(".elements__like-counter");return function(e,t,n,o,r){o.addEventListener("click",(function(){i(e),function(e,t,n,o){e.src=n.src,e.alt=n.alt,t.textContent=o}(t,n,o,r)}))}(e,o,r,d,c.name),u(p,c.likes.length),c.owner._id===a&&((s=l.querySelector(".elements__trash-button")).style.display="block",s.addEventListener("click",(function(){var e,o=s.closest(".elements__item");(e=o.id,n("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})).then((function(){o.remove()})).catch((function(e){return console.log(e)}))}))),c.likes.forEach((function(e){e._id===a&&f.classList.add("elements__like-button_active")})),l.querySelector(".elements__text").textContent=c.name,d.alt=c.name,d.src=c.link,l.id=c._id,function(e,o){!function(e,o){var r=e.querySelector(".elements__like-button");r.addEventListener("click",(function(){var c,i;r.classList.contains("elements__like-button_active")?(i=e.id,c=n("".concat(t.baseUrl,"/cards/likes/").concat(i),{method:"DELETE",headers:t.headers})):c=function(e){return n("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(e.id),c.then((function(e){u(o,e.likes.length),r.classList.toggle("elements__like-button_active")})).catch((function(e){return console.log(e)}))}))}(e,o)}(l,p),l},l=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n),o.textContent=""},d=function(e,t,n){var o=function(e){return e.some((function(e){return!e.validity.valid}))}(e);o?t.classList.add(n):t.classList.remove(n),t.disabled=o},f=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.classList.remove(t.inputErrorClass),n.setCustomValidity(""),l(e,n,t.errorClass)})),d(n,o,t.inactiveButtonClass)};function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var m='.popup__item[id="heading"]',v='.popup__item[id="subheading"]',y=document.querySelector(".profile__title"),_=document.querySelector(".profile__subtitle"),h=document.querySelector(".elements__items"),b=document.querySelector(".popup_position_img"),S=b.querySelector(".popup__image"),C=b.querySelector(".popup__text"),E=document.forms.profile,q=E.closest(".popup"),L=E.querySelector(m),g=E.querySelector(v),k=document.forms.place,x=k.closest(".popup"),A=k.querySelector(m),U=k.querySelector(v),B=document.forms.photo,T=B.closest(".popup"),j=B.querySelector(m),O=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__edit-button"),w=document.querySelector(".profile__edit-photo-button"),D=document.querySelector(".profile__avatar"),M=document.querySelectorAll(e.closeBtnSelector),N="";M.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return a(t)}))}));var I=function(){L.value=y.textContent,g.value=_.textContent},J=function(e){y.textContent=e.name,_.textContent=e.about,D.src=e.avatar,N=e._id};E.addEventListener("submit",(function(e){return function(e,o){e.preventDefault();var r,c,i=e.submitter.textContent;e.submitter.textContent="Сохранение...",(r=L.value,c=g.value,n("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:c})})).then((function(e){J(e),a(o)})).catch((function(e){console.log("Ошибка ".concat(e))})).finally((function(){e.submitter.textContent=i}))}(e,q)})),function(t){P.addEventListener("click",(function(){i(t),I(),f(E,e)}))}(q),I(),k.addEventListener("submit",(function(o){return function(o,r,c){o.preventDefault();var i,u,l=o.submitter.textContent;o.submitter.textContent="Сохранение...",(i=A.value,u=U.value,n("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:i,link:u})})).then((function(t){var n=s(b,S,C,t,N);!function(e,t){e.prepend(t)}(h,n),a(c),r.reset(),f(c,e)})).catch((function(e){console.log("Ошибка ".concat(e))})).finally((function(){o.submitter.textContent=l}))}(o,k,x)})),function(e){O.addEventListener("click",(function(){i(e)}))}(x),B.addEventListener("submit",(function(o){return function(o,r,c){o.preventDefault();var i=o.submitter.textContent;o.submitter.textContent="Сохранение...",function(e){return n("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})})}(j.value).then((function(t){D.src=t.avatar,a(c),r.reset(),f(c,e)})).catch((function(){console.log("Ошибка ".concat(err))})).finally((function(){o.submitter.textContent=i}))}(o,B,T)})),function(e){w.addEventListener("click",(function(){i(e)}))}(T),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t,n,o,r,c){d(e,t,o),e.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(l(e,t,o),t.classList.remove(n)):(function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o)}(e,t,t.validationMessage,o),t.classList.add(n))}(n,i,r,c),d(e,t,o)}))}))}(Array.from(t.querySelectorAll(e.inputSelector)),t.querySelector(e.submitButtonSelector),t,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)}))}(e),Promise.all([n("".concat(t.baseUrl,"/users/me"),{headers:t.headers}),n("".concat(t.baseUrl,"/cards"),{headers:t.headers})]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];J(r),c.forEach((function(e){var t=s(b,S,C,e,N);!function(e,t){e.append(t)}(h,t)}))})).catch((function(e){return console.log(e)}))})();