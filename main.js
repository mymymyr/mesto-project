(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",closeBtnSelector:".popup__close-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"form__input-error"},t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14/",headers:{authorization:"eaada802-eae7-468f-b2f3-51d625f02b5e","Content-Type":"application/json"}};function n(e,t){return fetch(e,t).then((function(e){return function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}(e)}))}function o(e){e.target.classList.contains("popup")&&i(e.target)}function r(e){Array.from(document.querySelectorAll(".popup")).forEach((function(t){"Escape"===e.key&&t.classList.contains("popup_opened")&&i(t)}))}var c=function(e){e.classList.add("popup_opened"),e.addEventListener("click",o),document.addEventListener("keyup",r)},i=function(e){e.classList.remove("popup_opened"),e.removeEventListener("click",o),document.removeEventListener("keyup",r)},u=function(e,t){e.textContent=t},a=function(e,o,r,i,a){var s,l=document.querySelector("#elements__item-template").content.querySelector(".elements__item").cloneNode(!0),d=l.querySelector(".elements__image"),f=l.querySelector(".elements__like-button"),p=l.querySelector(".elements__like-counter");return function(e,t,n,o,r){o.addEventListener("click",(function(){c(e),function(e,t,n,o){e.src=n.src,e.alt=n.alt,t.textContent=o}(t,n,o,r)}))}(e,o,r,d,i.name),u(p,i.likes.length),i.owner._id===a&&((s=l.querySelector(".elements__trash-button")).style.display="block",s.addEventListener("click",(function(){var e,o=s.closest(".elements__item");(e=o.id,n("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})).then((function(){o.remove()})).catch((function(e){return console.log(e)}))}))),i.likes.forEach((function(e){e._id===a&&f.classList.add("elements__like-button_active")})),l.querySelector(".elements__text").textContent=i.name,d.alt=i.name,d.src=i.link,l.id=i._id,function(e,o){!function(e,o){var r=e.querySelector(".elements__like-button");r.addEventListener("click",(function(){var c,i;r.classList.contains("elements__like-button_active")?(i=e.id,c=n("".concat(t.baseUrl,"/cards/likes/").concat(i),{method:"DELETE",headers:t.headers})):c=function(e){return n("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(e.id),c.then((function(e){u(o,e.likes.length),r.classList.toggle("elements__like-button_active")})).catch((function(e){return console.log(e)}))}))}(e,o)}(l,p),l},s=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n),o.textContent=""},l=function(e,t,n){var o=function(e){return e.some((function(e){return!e.validity.valid}))}(e);o?t.classList.add(n):t.classList.remove(n),t.disabled=o},d=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.classList.remove(t.inputErrorClass),n.setCustomValidity(""),s(e,n,t.errorClass)})),l(n,o,t.inactiveButtonClass)},f='.popup__item[id="heading"]',p='.popup__item[id="subheading"]',m=document.querySelector(".profile__title"),_=document.querySelector(".profile__subtitle"),v=document.querySelector(".elements__items"),y=document.querySelector(".popup_position_img"),h=y.querySelector(".popup__image"),b=y.querySelector(".popup__text"),S=document.forms.profile,C=S.closest(".popup"),q=S.querySelector(f),E=S.querySelector(p),L=document.forms.place,k=L.closest(".popup"),g=L.querySelector(f),x=L.querySelector(p),A=document.forms.photo,U=A.closest(".popup"),B=A.querySelector(f),T=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__edit-photo-button"),N=document.querySelector(".profile__avatar"),O=document.querySelectorAll(e.closeBtnSelector),j="";O.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return i(t)}))}));var J=function(){q.value=m.textContent,E.value=_.textContent},M=function(e){m.textContent=e.name,_.textContent=e.about,N.src=e.avatar,j=e._id};S.addEventListener("submit",(function(e){return function(e,o){e.preventDefault();var r,c,u=e.submitter.textContent;e.submitter.textContent="Сохранение...",(r=q.value,c=E.value,n("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:c})})).then((function(e){M(e),i(o)})).catch((function(e){console.log("Ошибка ".concat(e))})).finally((function(){e.submitter.textContent=u}))}(e,C)})),function(t){P.addEventListener("click",(function(){c(t),J(),d(S,e)}))}(C),J(),L.addEventListener("submit",(function(o){return function(o,r,c){o.preventDefault();var u,s,l=o.submitter.textContent;o.submitter.textContent="Сохранение...",(u=g.value,s=x.value,n("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:u,link:s})})).then((function(t){var n=a(y,h,b,t,j);!function(e,t){e.prepend(t)}(v,n),i(c),r.reset(),d(c,e)})).catch((function(e){console.log("Ошибка ".concat(e))})).finally((function(){o.submitter.textContent=l}))}(o,L,k)})),function(e){T.addEventListener("click",(function(){c(e)}))}(k),A.addEventListener("submit",(function(o){return function(o,r,c){o.preventDefault();var u=o.submitter.textContent;o.submitter.textContent="Сохранение...",function(e){return n("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})})}(B.value).then((function(t){N.src=t.avatar,i(c),r.reset(),d(c,e)})).catch((function(){console.log("Ошибка ".concat(err))})).finally((function(){o.submitter.textContent=u}))}(o,A,U)})),function(e){D.addEventListener("click",(function(){c(e)}))}(U),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t,n,o,r,c){l(e,t,o),e.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(s(e,t,o),t.classList.remove(n)):(function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o)}(e,t,t.validationMessage,o),t.classList.add(n))}(n,i,r,c),l(e,t,o)}))}))}(Array.from(t.querySelectorAll(e.inputSelector)),t.querySelector(e.submitButtonSelector),t,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)}))}(e),Promise.all([n("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return M(e)})),n("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){e.forEach((function(e){var t=a(y,h,b,e,j);!function(e,t){e.append(t)}(v,t)}))}))]).catch((function(e){return console.log(e)}))})();